<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat√°logo Tyson Autoparts</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>Tyson Autoparts</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="catalog.html">Cat√°logo</a></li>
        <li><a href="contact.html">Contacto</a></li>
      </ul>
    </nav>
    <div class="searchbar">
      <input id="search" type="text" placeholder="Buscar autoparte..." />
      <select id="categoria">
        <option value="">Todas</option>
      </select>
    </div>
  </header>

  <main class="vitrina">
    <!-- Banner con imagen representativa -->
    <div class="banner">
      <h2>Tyson Autoparts</h2>
      <p>Encuentra la pieza que necesitas</p>
    </div>

    <!-- Piezas destacadas -->
    <section id="destacados" class="grid"></section>   <!-- Bloque de confianza -->
    <section class="confianza">
  <h2>Compra con confianza</h2>
  <div class="confianza-grid">
    <div class="confianza-item">
      <a href="#garantiaModal">
        <span class="icon">üõ°</span>
        <h3>Garant√≠a Tyson</h3>
        <p>Piezas revisadas y garantizadas para tu seguridad.</p>
      </a>
    </div>
    <div class="confianza-item">
  <a href="#enviosModal">
    <span class="icon">üöö</span>
    <h3>Env√≠os seguros</h3>
    <p>Entrega r√°pida y confiable en todo Chihuahua y mexico.</p>
  </a>
</div><!-- Modal de Env√≠os -->
<div id="enviosModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>Opciones de env√≠o</h2>
    <ul>
      <li>üì¶ Env√≠os seguros por medio de <strong>Mercado Libre</strong>.</li>
      <li>üöö Tambi√©n podemos enviar por la <strong>paqueter√≠a de su preferencia</strong> si es dentro del estado.</li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20los%20env√≠os%20seguros" target="_blank">üì≤ Preguntar por WhatsApp</a>
  </div>
</div>


<div class="confianza-item">
  <a href="#atencionModal">
    <span class="icon">ü§ù</span>
    <h3>Atenci√≥n directa</h3>
    <p>Comunicaci√≥n inmediata por WhatsApp y Facebook.</p>
  </a>
</div>
<!-- Modal de Atenci√≥n directa -->
<div id="atencionModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>Atenci√≥n directa</h2>
    <p>Estamos disponibles para resolver tus dudas y ayudarte a encontrar la pieza que necesitas.</p>
    <ul>
      <li>üì≤ WhatsApp: <a href="https://wa.me/5216141315986" target="_blank">Enviar mensaje</a></li>
      <li>üîó Facebook: <a href="https://facebook.com/tysonautoparts" target="_blank">Vis√≠tanos</a></li>
    </ul>
    <p><strong>Horario de atenci√≥n:</strong> Lunes a viernes de 9:00 AM a 6:00 PM</p>
  </div>
</div>


</section>

<!-- Modal de Garant√≠as -->
<div id="garantiaModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
 <!-- Bot√≥n de cerrar en forma de X -->
    <h2>Tipos de garant√≠a</h2>
    <ul>
      <li>üîß Piezas est√©ticas: <strong>No damos garant√≠a</strong></li>
      <li>üì∫ Est√©reos o pantallas: <strong>3 d√≠as de garant√≠a</strong></li>
      <li>‚ö° Marchas, alternadores y compresores: <strong>3 d√≠as de garant√≠a</strong></li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20las%20garant√≠as" target="_blank">üì≤ Preguntar por WhatsApp</a>
  </div>
</div>


</section>



    <!-- Contacto lateral -->
    <aside class="contacto">
      <h3>Contacto directo</h3>
      <a class="wa-btn" href="https://wa.me/5216141315986" target="_blank">üì≤ WhatsApp</a>
      <a class="fb-btn" href="https://facebook.com/tysonautoparts" target="_blank">üîó Facebook</a>
    </aside>
  </main>

  <footer>
    <p>&copy; 2025 Tyson Autoparts | Bryan</p>
  </footer>

  <!-- Modal para imagen ampliada -->
  <div id="imgModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="imgGrande">
  </div>

 <script>
  const normalize = s => (s || "")
    .toString()
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .trim();

  const stopWords = ["de","del","la","el","los","las","para","por","un","una"];
  let productos = [];

  function parseLine(line) {
    if (!line || !line.trim()) return null;
    const low = line.trim().toLowerCase();
    if (low.startsWith("titulo,descripcion,precio,estado,imagen,categoria")) return null;
    const cols = line.split(",").map(v => v.trim());
    while (cols.length < 6) cols.push("");
    return { titulo: cols[0], descripcion: cols[1], precio: cols[2], estado: cols[3], imagen: cols[4], categoria: cols[5] };
  }

  // Crear tarjeta con im√°genes
  function crearCard(row) {
    const est = (row.estado || "").trim().toUpperCase();
    if (est === "VENDIDA") return null;

    const card = document.createElement("div");
    card.className = "product-card";
    card.setAttribute("data-categoria", normalize(row.categoria));

    // Mostrar solo la primera imagen y abrir carrusel con todas
   let imgHtml = "";
if (row.imagenes && Array.isArray(row.imagenes) && row.imagenes.length > 0) {
  imgHtml = `<img src="${row.imagenes[0]}" alt="${row.titulo}" onclick='abrirFicha(${JSON.stringify(row)})'>`;
} else if (row.imagen) {
  imgHtml = `<img src="${row.imagen}" alt="${row.titulo}" onclick='abrirFicha(${JSON.stringify(row)})'>`;
} else {
  imgHtml = `<div class="placeholder">Sin imagen</div>`;
}

    const precioTxt = row.precio ? `$${row.precio}` : "‚Äî";

    card.innerHTML = `
      ${imgHtml}
      <div class="product-info">
        <h3>${row.titulo}</h3>
        ${row.descripcion ? `<p class="descripcion">${row.descripcion}</p>` : ""}
        <p class="precio">${precioTxt}</p>
        <span class="estado-disponible">‚úÖ Disponible</span>
        <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20${encodeURIComponent(row.titulo)}" target="_blank">üì≤ Comprar por WhatsApp</a>
      </div>
    `;
    return card;
  }

  function aplicarFiltros() {
    const term = normalize(document.getElementById("search").value);
    const catFilter = document.getElementById("categoria").value;
    const words = term.split(/\s+/).filter(w => w && !stopWords.includes(w));

    const container = document.getElementById("destacados");
    container.innerHTML = "";

    let filtrados = productos.filter(row => {
      const text = normalize(`${row.titulo} ${row.descripcion} ${row.categoria}`);
      const cat = normalize(row.categoria);

      const matchText = words.length === 0 ? true : words.every(w => text.includes(w));
      const matchCat = !catFilter || cat === catFilter;

      return matchText && matchCat && (row.estado || "").toUpperCase() !== "VENDIDA";
    });

    filtrados.forEach(row => {
      const card = crearCard(row);
      if (card) container.appendChild(card);
    });
  }

   // Cargar productos manuales y de Mercado Libre
  fetch("catalogo.csv")
    .then(r => r.text())
    .then(raw => {
      const lines = raw.split(/\r?\n/);
      lines.forEach(line => {
        const obj = parseLine(line);
        if (obj && obj.titulo) productos.push(obj);
      });

      // üëâ Aqu√≠ cargas productos de Mercado Libre
      fetch("https://tyson-autopartes.vercel.app/api/items")
        .then(r => r.json())
        .then(data => {
          if (!data.items || !Array.isArray(data.items)) return;

          data.items.forEach(item => {
            productos.push({
              titulo: item.titulo,
              descripcion: item.descripcion || "",
              precio: item.precio,
              estado: "ACTIVA",
              imagenes: Array.isArray(item.imagenes) ? item.imagenes : (item.imagen ? [item.imagen] : []),
              categoria: item.categoria || detectarCategoria(item.titulo), // üëà usamos la funci√≥n aqu√≠
              link: item.link
            });
          });

          // Cuando ya est√°n todos los productos:
          poblarCategorias();
          aplicarFiltros();
        })
        .catch(err => console.error("Error cargando productos Mercado Libre:", err));

      // Activar filtros
      document.getElementById("search").addEventListener("input", aplicarFiltros);
      document.getElementById("categoria").addEventListener("change", aplicarFiltros);
    })
    .catch(err => console.error("Error cargando catalogo.csv:", err));

  // üëá Funci√≥n global para detectar categor√≠a desde el t√≠tulo
  function detectarCategoria(titulo) {
    const t = normalize(titulo);
    if (t.includes("faro")) return "faros";
    if (t.includes("calavera")) return "calaveras";
    if (t.includes("cofre")) return "cofres";
    if (t.includes("parrilla")) return "parrillas";
    if (t.includes("defensa")) return "defensas";
    if (t.includes("espejo")) return "espejos";
    return "otros";
  }

  // üëá Funci√≥n para poblar categor√≠as en el <select>
  function poblarCategorias() {
    const select = document.getElementById("categoria");
    select.innerHTML = `<option value="">Todas</option>`;
    const set = new Set(productos.map(p => normalize(p.categoria)).filter(Boolean));
    [...set].sort().forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
      select.appendChild(opt);
    });
  }

  // Modal para ampliar im√°genes
  function activarModalImagen(imgElement) {
    const modal = document.getElementById("imgModal");
    const imgGrande = document.getElementById("imgGrande");
    imgGrande.src = imgElement.src;
    modal.style.display = "block";
  }

  document.querySelector("#imgModal .close").onclick = function() {
    document.getElementById("imgModal").style.display = "none";
  };

  document.getElementById("imgModal").onclick = function(e) {
    if (e.target.id === "imgModal") {
      document.getElementById("imgModal").style.display = "none";
    }
  };
</script>

<!-- Modal Carrusel -->
<div id="carruselModal" class="modal">
  <span class="close" onclick="cerrarCarrusel()">&times;</span>
  <div class="carrusel-container">
    <button class="prev" onclick="cambiarImagen(-1)">&#10094;</button>
    <img id="carruselImagen" class="carrusel-imagen">
    <button class="next" onclick="cambiarImagen(1)">&#10095;</button>
  </div>
  <div id="carruselMiniaturas" class="miniaturas"></div>
</div>

<script>
  let imagenesCarrusel = [];
  let indiceActual = 0;

  function abrirCarrusel(imagenes) {
    imagenesCarrusel = Array.isArray(imagenes) ? imagenes : [];
    indiceActual = 0;
    document.getElementById("carruselModal").style.display = "block";
    mostrarImagenCarrusel();
  }

  function cerrarCarrusel() {
    document.getElementById("carruselModal").style.display = "none";
  }

  function cambiarImagen(direccion) {
    indiceActual += direccion;
    if (indiceActual < 0) indiceActual = imagenesCarrusel.length - 1;
    if (indiceActual >= imagenesCarrusel.length) indiceActual = 0;
    mostrarImagenCarrusel();
  }

  function mostrarImagenCarrusel() {
    const img = document.getElementById("carruselImagen");
    img.src = imagenesCarrusel[indiceActual] || "";

    const miniaturas = document.getElementById("carruselMiniaturas");
    miniaturas.innerHTML = imagenesCarrusel.map((url, i) =>
      `<img src="${url}" class="miniatura ${i === indiceActual ? "activo" : "difuminado"}" onclick="irAImagen(${i})">`
    ).join("");
  }

  function irAImagen(i) {
    indiceActual = i;
    mostrarImagenCarrusel();
  }

  function abrirFicha(row) {
  imagenesCarrusel = Array.isArray(row.imagenes)
    ? row.imagenes
    : (row.imagen ? [row.imagen] : []);

  indiceActual = 0;

  document.getElementById("fichaTitulo").textContent = row.titulo;
  document.getElementById("fichaDescripcion").textContent = row.descripcion?.trim()
    ? row.descripcion
    : "Sin descripci√≥n disponible.";
  document.getElementById("fichaPrecio").textContent = row.precio ? `$${row.precio}` : "‚Äî";

  document.getElementById("btnWhatsapp").href =
    `https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20${encodeURIComponent(row.titulo)}`;

  if (row.link) {
    document.getElementById("btnMercadoLibre").style.display = "inline-block";
    document.getElementById("btnMercadoLibre").href = row.link;
  } else {
    document.getElementById("btnMercadoLibre").style.display = "none";
  }

  document.getElementById("fichaModal").style.display = "block";
  mostrarImagenFicha(); // üëà esta funci√≥n usa imagenesCarrusel
}

  function cerrarFicha() {
    document.getElementById("fichaModal").style.display = "none";
  }
</script>
  function mostrarImagenFicha() {
  const img = document.getElementById("fichaImagen");
  img.src = imagenesCarrusel[indiceActual] || "";

  const miniaturas = document.getElementById("fichaMiniaturas");
  miniaturas.innerHTML = imagenesCarrusel.map((url, i) =>
    `<img src="${url}" class="miniatura ${i === indiceActual ? "activo" : "difuminado"}" onclick="irAImagen(${i})">`
  ).join("");
}
  <script>
  function irAImagen(i) {
    indiceActual = i;
    mostrarImagenFicha();
  }
</script>

<!-- Modal Ficha de Producto -->
<div id="fichaModal" class="modal">
  <span class="close" onclick="cerrarFicha()">&times;</span>
  <div class="ficha-contenido">
    <div class="ficha-imagenes">
      <button class="prev" onclick="cambiarImagen(-1)">&#10094;</button>
      <img id="fichaImagen" class="carrusel-imagen">
      <button class="next" onclick="cambiarImagen(1)">&#10095;</button>
      <div id="fichaMiniaturas" class="miniaturas"></div>
    </div>
    <div class="ficha-info">
      <h2 id="fichaTitulo"></h2>
      <p id="fichaDescripcion"></p>
      <p id="fichaPrecio"></p>
      <div class="botones-compra">
        <a id="btnWhatsapp" class="wa-btn" target="_blank">üì≤ Comprar por WhatsApp</a>
        <a id="btnMercadoLibre" class="ml-btn" target="_blank">üõí Ver en Mercado Libre</a>
      </div>
    </div>
  </div>
</div>

<!-- Contenedor para mostrar publicaciones -->
<div id="productos"></div>

</body>
</html>


