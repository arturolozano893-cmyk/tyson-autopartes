<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CatÃ¡logo Tyson Autoparts</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>Tyson Autoparts</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="catalog.html">CatÃ¡logo</a></li>
        <li><a href="contact.html">Contacto</a></li>
      </ul>
    </nav>
    <div class="searchbar">
      <input id="search" type="text" placeholder="Buscar autoparte..." />
      <select id="categoria">
        <option value="">Todas</option>
      </select>
    </div>
  </header>

  <main class="vitrina">
    <!-- Banner con imagen representativa -->
    <div class="banner">
      <h2>Tyson Autoparts</h2>
      <p>Encuentra la pieza que necesitas</p>
    </div>

    <!-- Piezas destacadas -->
    <section id="destacados" class="grid"></section>   <!-- Bloque de confianza -->
    <section class="confianza">
  <h2>Compra con confianza</h2>
  <div class="confianza-grid">
    <div class="confianza-item">
      <a href="#garantiaModal">
        <span class="icon">ğŸ›¡</span>
        <h3>GarantÃ­a Tyson</h3>
        <p>Piezas revisadas y garantizadas para tu seguridad.</p>
      </a>
    </div>
    <div class="confianza-item">
  <a href="#enviosModal">
    <span class="icon">ğŸšš</span>
    <h3>EnvÃ­os seguros</h3>
    <p>Entrega rÃ¡pida y confiable en todo Chihuahua y mexico.</p>
  </a>
</div><!-- Modal de EnvÃ­os -->
<div id="enviosModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>Opciones de envÃ­o</h2>
    <ul>
      <li>ğŸ“¦ EnvÃ­os seguros por medio de <strong>Mercado Libre</strong>.</li>
      <li>ğŸšš TambiÃ©n podemos enviar por la <strong>paqueterÃ­a de su preferencia</strong> si es dentro del estado.</li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaciÃ³n%20sobre%20los%20envÃ­os%20seguros" target="_blank">ğŸ“² Preguntar por WhatsApp</a>
  </div>
</div>


<div class="confianza-item">
  <a href="#atencionModal">
    <span class="icon">ğŸ¤</span>
    <h3>AtenciÃ³n directa</h3>
    <p>ComunicaciÃ³n inmediata por WhatsApp y Facebook.</p>
  </a>
</div>
<!-- Modal de AtenciÃ³n directa -->
<div id="atencionModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>AtenciÃ³n directa</h2>
    <p>Estamos disponibles para resolver tus dudas y ayudarte a encontrar la pieza que necesitas.</p>
    <ul>
      <li>ğŸ“² WhatsApp: <a href="https://wa.me/5216141315986" target="_blank">Enviar mensaje</a></li>
      <li>ğŸ”— Facebook: <a href="https://facebook.com/tysonautoparts" target="_blank">VisÃ­tanos</a></li>
    </ul>
    <p><strong>Horario de atenciÃ³n:</strong> Lunes a viernes de 9:00 AM a 6:00 PM</p>
  </div>
</div>


</section>

<!-- Modal de GarantÃ­as -->
<div id="garantiaModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
 <!-- BotÃ³n de cerrar en forma de X -->
    <h2>Tipos de garantÃ­a</h2>
    <ul>
      <li>ğŸ”§ Piezas estÃ©ticas: <strong>No damos garantÃ­a</strong></li>
      <li>ğŸ“º EstÃ©reos o pantallas: <strong>3 dÃ­as de garantÃ­a</strong></li>
      <li>âš¡ Marchas, alternadores y compresores: <strong>3 dÃ­as de garantÃ­a</strong></li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaciÃ³n%20sobre%20las%20garantÃ­as" target="_blank">ğŸ“² Preguntar por WhatsApp</a>
  </div>
</div>


</section>



    <!-- Contacto lateral -->
    <aside class="contacto">
      <h3>Contacto directo</h3>
      <a class="wa-btn" href="https://wa.me/5216141315986" target="_blank">ğŸ“² WhatsApp</a>
      <a class="fb-btn" href="https://facebook.com/tysonautoparts" target="_blank">ğŸ”— Facebook</a>
    </aside>
  </main>

  <footer>
    <p>&copy; 2025 Autopartes Lozano | </p>
  </footer>

  <!-- Modal para imagen ampliada -->
  <div id="imgModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="imgGrande">
  </div>

 <script>
  const normalize = s => (s || "")
    .toString()
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")
    .trim();

  const stopWords = ["de","del","la","el","los","las","para","por","un","una"];
  let productos = [];

  function parseLine(line) {
    if (!line || !line.trim()) return null;
    const low = line.trim().toLowerCase();
    if (low.startsWith("titulo,descripcion,precio,estado,imagen,categoria")) return null;
    const cols = line.split(",").map(v => v.trim());
    while (cols.length < 6) cols.push("");
    return { titulo: cols[0], descripcion: cols[1], precio: cols[2], estado: cols[3], imagen: cols[4], categoria: cols[5] };
  }

  // Crear tarjeta con imÃ¡genes
  function crearCard(row) {
    const est = (row.estado || "").trim().toUpperCase();
    if (est === "VENDIDA") return null;

    const card = document.createElement("div");
    card.className = "product-card";
    card.setAttribute("data-categoria", normalize(row.categoria));

    // Mostrar solo la primera imagen y abrir carrusel con todas
   let imgHtml = "";
if (row.imagenes && Array.isArray(row.imagenes) && row.imagenes.length > 0) {
  imgHtml = `<img src="${row.imagenes[0]}" alt="${row.titulo}" onclick='abrirFicha(${JSON.stringify(row)})'>`;
} else if (row.imagen) {
  imgHtml = `<img src="${row.imagen}" alt="${row.titulo}" onclick='abrirFicha(${JSON.stringify(row)})'>`;
} else {
  imgHtml = `<div class="placeholder">Sin imagen</div>`;
}

    const precioTxt = row.precio ? `$${row.precio}` : "â€”";

    card.innerHTML = `
      ${imgHtml}
      <div class="product-info">
        <h3>${row.titulo}</h3>
        ${row.descripcion ? `<p class="descripcion">${row.descripcion}</p>` : ""}
        <p class="precio">${precioTxt}</p>
        <span class="estado-disponible">âœ… Disponible</span>
        <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaciÃ³n%20sobre%20${encodeURIComponent(row.titulo)}" target="_blank">ğŸ“² Comprar por WhatsApp</a>
      </div>
    `;
    return card;
  }

 function aplicarFiltros() {
  const term = normalize(document.getElementById("search").value);
  const catFilter = normalize(document.getElementById("categoria").value);
  const words = term.split(/\s+/).filter(w => w && !stopWords.includes(w));

  const container = document.getElementById("destacados");
  container.innerHTML = "";

  let filtrados = productos.filter(row => {
    const text = normalize(`${row.titulo} ${row.descripcion} ${row.categoria}`);
    const cat = normalize(row.categoria);
    const est = (row.estado || "").trim().toUpperCase();

    const matchText = words.length === 0 ? true : words.every(w => text.includes(w));
    const matchCat = !catFilter || normalize(cat) === normalize(catFilter);

    return matchText && matchCat && est !== "VENDIDA";
  });

  filtrados.forEach(row => {
    const card = crearCard(row);
    if (card) container.appendChild(card);
  });
}
   // Cargar productos manuales y de Mercado Libre
  fetch("catalogo.csv")
    .then(r => r.text())
    .then(raw => {
      const lines = raw.split(/\r?\n/);
      lines.forEach(line => {
        const obj = parseLine(line);
        if (obj && obj.titulo) productos.push(obj);
      });

      // ğŸ‘‰ AquÃ­ cargas productos de Mercado Libre
      fetch("https://tyson-autopartes.vercel.app/api/items")
        .then(r => r.json())
        .then(data => {
          if (!data.items || !Array.isArray(data.items)) return;

          data.items.forEach(item => {
            productos.push({
              titulo: item.titulo,
              descripcion: item.descripcion || "",
              precio: item.precio,
              estado: "ACTIVA",
              imagenes: Array.isArray(item.imagenes) ? item.imagenes : (item.imagen ? [item.imagen] : []),
              categoria: item.categoria || detectarCategoria(item.titulo), // ğŸ‘ˆ usamos la funciÃ³n aquÃ­
              link: item.link
            });
          });

          // Cuando ya estÃ¡n todos los productos:
          poblarCategorias();
          aplicarFiltros();
        })
        .catch(err => console.error("Error cargando productos Mercado Libre:", err));

      // Activar filtros
      document.getElementById("search").addEventListener("input", aplicarFiltros);
      document.getElementById("categoria").addEventListener("change", aplicarFiltros);
    })
    .catch(err => console.error("Error cargando catalogo.csv:", err));

  // ğŸ‘‡ FunciÃ³n global para detectar categorÃ­a desde el tÃ­tulo
 function detectarCategoria(titulo) {
  const t = normalize(titulo);
  if (t.includes("faro")) return "faros";
  if (t.includes("calavera")) return "calaveras";
  if (t.includes("cofre")) return "cofres";
  if (t.includes("parrilla")) return "parrillas";
  if (t.includes("defensa")) return "defensas";
  if (t.includes("espejo")) return "espejos";
  if (t.includes("facia")) return "facias";
  if (t.includes("estereo") || t.includes("pantalla")) return "estereos";
  if (t.includes("rin")) return "rines";
  if (t.includes("puerta")) return "puertas";
  if (t.includes("control")) return "controles";
  if (t.includes("modulo")) return "modulos";
  if (t.includes("vidrio")) return "vidrios";
  if (t.includes("alternador")) return "alternadores";
  if (t.includes("marcha")) return "marchas";
  if (t.includes("compresor")) return "compresores";
  if (t.includes("computadora")) return "computadoras";
  if (t.includes("cremallera")) return "cremayeras";
  return "otros";
}


  // ğŸ‘‡ FunciÃ³n para poblar categorÃ­as en el <select>
  function poblarCategorias() {
    const select = document.getElementById("categoria");
    select.innerHTML = `<option value="">Todas</option>`;
    const set = new Set(productos.map(p => normalize(p.categoria)).filter(Boolean));
    [...set].sort().forEach(cat => {
      const opt = document.createElement("option");
      opt.value = cat;
      opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
      select.appendChild(opt);
    });
  }

  // Modal para ampliar imÃ¡genes
  function activarModalImagen(imgElement) {
    const modal = document.getElementById("imgModal");
    const imgGrande = document.getElementById("imgGrande");
    imgGrande.src = imgElement.src;
    modal.style.display = "block";
  }

  document.querySelector("#imgModal .close").onclick = function() {
    document.getElementById("imgModal").style.display = "none";
  };

  document.getElementById("imgModal").onclick = function(e) {
    if (e.target.id === "imgModal") {
      document.getElementById("imgModal").style.display = "none";
    }
  };
</script>

<!-- Modal Carrusel -->
<div id="carruselModal" class="modal">
  <span class="close" onclick="cerrarCarrusel()">&times;</span>
  <div class="carrusel-container">
    <button class="prev" onclick="cambiarImagen(-1)">&#10094;</button>
    <img id="carruselImagen" class="carrusel-imagen">
    <button class="next" onclick="cambiarImagen(1)">&#10095;</button>
  </div>
  <div id="carruselMiniaturas" class="miniaturas"></div>
</div>

<script>
  let imagenesCarrusel = [];
  let indiceActual = 0;

  function abrirFicha(row) {
    imagenesCarrusel = Array.isArray(row.imagenes)
      ? row.imagenes
      : (row.imagen ? [row.imagen] : []);
    indiceActual = 0;

    document.getElementById("fichaTitulo").textContent = row.titulo;
    document.getElementById("fichaDescripcion").textContent = row.descripcion?.trim()
      ? row.descripcion
      : "Sin descripciÃ³n disponible.";
    document.getElementById("fichaPrecio").textContent = row.precio ? `$${row.precio}` : "â€”";

    document.getElementById("btnWhatsapp").href =
      `https://wa.me/5216141315986?text=Hola%20quiero%20informaciÃ³n%20sobre%20${encodeURIComponent(row.titulo)}`;

    if (row.link) {
      document.getElementById("btnMercadoLibre").style.display = "inline-block";
      document.getElementById("btnMercadoLibre").href = row.link;
    } else {
      document.getElementById("btnMercadoLibre").style.display = "none";
    }

    document.getElementById("fichaModal").style.display = "block";
    mostrarImagenFicha();
  }

  function cerrarFicha() {
    document.getElementById("fichaModal").style.display = "none";
  }

  function mostrarImagenFicha() {
    const img = document.getElementById("fichaImagen");
    img.src = imagenesCarrusel[indiceActual] || "";

    const miniaturas = document.getElementById("fichaMiniaturas");
    miniaturas.innerHTML = imagenesCarrusel.map((url, i) =>
      `<img src="${url}" class="miniatura ${i === indiceActual ? "activo" : "difuminado"}" onclick="irAImagen(${i})">`
    ).join("");
  }

  function irAImagen(i) {
    indiceActual = i;
    mostrarImagenFicha();
  }

  function cambiarImagen(direccion) {
    indiceActual += direccion;
    if (indiceActual < 0) indiceActual = imagenesCarrusel.length - 1;
    if (indiceActual >= imagenesCarrusel.length) indiceActual = 0;
    mostrarImagenFicha();
  }
</script>

<!-- Modal Ficha de Producto -->
<div id="fichaModal" class="modal">
  <span class="close" onclick="cerrarFicha()">&times;</span>
  <div class="ficha-contenido">
    <div class="ficha-imagenes">
      <button class="prev" onclick="cambiarImagen(-1)">&#10094;</button>
      <img id="fichaImagen" class="carrusel-imagen">
      <button class="next" onclick="cambiarImagen(1)">&#10095;</button>
      <div id="fichaMiniaturas" class="miniaturas"></div>
    </div>
    <div class="ficha-info">
      <h2 id="fichaTitulo"></h2>
      <p id="fichaDescripcion"></p>
      <p id="fichaPrecio"></p>
      <div class="botones-compra">
        <a id="btnWhatsapp" class="wa-btn" target="_blank">ğŸ“² Comprar por WhatsApp</a>
        <a id="btnMercadoLibre" class="ml-btn" target="_blank">ğŸ›’ Ver en Mercado Libre</a>
      </div>
    </div>
  </div>
</div>

<!-- Contenedor para mostrar publicaciones -->
<div id="productos"></div>

</body>
</html>








