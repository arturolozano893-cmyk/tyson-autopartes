<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat√°logo Tyson Autoparts</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>Tyson Autoparts</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="catalog.html">Cat√°logo</a></li>
        <li><a href="contact.html">Contacto</a></li>
      </ul>
    </nav>
    <div class="searchbar">
      <input id="search" type="text" placeholder="Buscar autoparte..." />
      <select id="categoria">
        <option value="">Todas</option>
      </select>
    </div>
  </header>

  <main class="vitrina">
    <!-- Banner con imagen representativa -->
    <div class="banner">
      <h2>Tyson Autoparts</h2>
      <p>Encuentra la pieza que necesitas</p>
    </div>

    <!-- Piezas destacadas -->
    <section id="destacados" class="grid"></section>    <!-- Bloque de confianza -->
    <section class="confianza">
  <h2>Compra con confianza</h2>
  <div class="confianza-grid">
    <div class="confianza-item">
      <a href="#garantiaModal">
        <span class="icon">üõ°Ô∏è</span>
        <h3>Garant√≠a Tyson</h3>
        <p>Piezas revisadas y garantizadas para tu seguridad.</p>
      </a>
    </div>
    <div class="confianza-item">
  <a href="#enviosModal">
    <span class="icon">üöö</span>
    <h3>Env√≠os seguros</h3>
    <p>Entrega r√°pida y confiable en todo Chihuahua y mexico.</p>
  </a>
</div><!-- Modal de Env√≠os -->
<div id="enviosModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>Opciones de env√≠o</h2>
    <ul>
      <li>üì¶ Env√≠os seguros por medio de <strong>Mercado Libre</strong>.</li>
      <li>üöö Tambi√©n podemos enviar por la <strong>paqueter√≠a de su preferencia</strong> si es dentro del estado.</li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20los%20env√≠os%20seguros" target="_blank">üì≤ Preguntar por WhatsApp</a>
  </div>
</div>


<div class="confianza-item">
  <a href="#atencionModal">
    <span class="icon">ü§ù</span>
    <h3>Atenci√≥n directa</h3>
    <p>Comunicaci√≥n inmediata por WhatsApp y Facebook.</p>
  </a>
</div>
<!-- Modal de Atenci√≥n directa -->
<div id="atencionModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
    <h2>Atenci√≥n directa</h2>
    <p>Estamos disponibles para resolver tus dudas y ayudarte a encontrar la pieza que necesitas.</p>
    <ul>
      <li>üì≤ WhatsApp: <a href="https://wa.me/5216141315986" target="_blank">Enviar mensaje</a></li>
      <li>üîó Facebook: <a href="https://facebook.com/tysonautoparts" target="_blank">Vis√≠tanos</a></li>
    </ul>
    <p><strong>Horario de atenci√≥n:</strong> Lunes a viernes de 9:00 AM a 6:00 PM</p>
  </div>
</div>


</section>

<!-- Modal de Garant√≠as -->
<div id="garantiaModal" class="modal">
  <div class="modal-content garantia-content">
    <a href="#" class="close">&times;</a>
 <!-- Bot√≥n de cerrar en forma de X -->
    <h2>Tipos de garant√≠a</h2>
    <ul>
      <li>üîß Piezas est√©ticas: <strong>No damos garant√≠a</strong></li>
      <li>üì∫ Est√©reos o pantallas: <strong>3 d√≠as de garant√≠a</strong></li>
      <li>‚ö° Marchas, alternadores y compresores: <strong>3 d√≠as de garant√≠a</strong></li>
    </ul>
    <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20las%20garant√≠as" target="_blank">üì≤ Preguntar por WhatsApp</a>
  </div>
</div>


</section>



    <!-- Contacto lateral -->
    <aside class="contacto">
      <h3>Contacto directo</h3>
      <a class="wa-btn" href="https://wa.me/5216141315986" target="_blank">üì≤ WhatsApp</a>
      <a class="fb-btn" href="https://facebook.com/tysonautoparts" target="_blank">üîó Facebook</a>
    </aside>
  </main>

  <footer>
    <p>&copy; 2025 Tyson Autoparts | Bryan</p>
  </footer>

  <!-- Modal para imagen ampliada -->
  <div id="imgModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="imgGrande">
  </div>

  <script>
    const normalize = s => (s || "")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();

    const stopWords = ["de","del","la","el","los","las","para","por","un","una"];
    let productos = [];

    function parseLine(line) {
      if (!line || !line.trim()) return null;
      const low = line.trim().toLowerCase();
      if (low.startsWith("titulo,descripcion,precio,estado,imagen,categoria")) return null;
      const cols = line.split(",").map(v => v.trim());
      while (cols.length < 6) cols.push("");
      return { titulo: cols[0], descripcion: cols[1], precio: cols[2], estado: cols[3], imagen: cols[4], categoria: cols[5] };
    }

    function crearCard(row) {
      const est = (row.estado || "").trim().toUpperCase();
      if (est === "VENDIDA") return null;
      const card = document.createElement("div");
      card.className = "product-card";
      card.setAttribute("data-categoria", normalize(row.categoria));
      const precioTxt = row.precio ? `$${row.precio}` : "‚Äî";
      const imgHtml = row.imagen ? `<img src="${row.imagen}" alt="${row.titulo}">` : `<div class="placeholder">Sin imagen</div>`;
      card.innerHTML = `
        ${imgHtml}
        <div class="product-info">
          <h3>${row.titulo}</h3>
          ${row.descripcion ? `<p class="descripcion">${row.descripcion}</p>` : ""}
          <p class="precio">${precioTxt}</p>
          <span class="estado-disponible">‚úÖ Disponible</span>
          <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaci√≥n%20sobre%20${encodeURIComponent(row.titulo)}" target="_blank">üì≤ Comprar por WhatsApp</a>
        </div>
      `;
      return card;
    }

    function aplicarFiltros() {
      const term = normalize(document.getElementById("search").value);
      const catFilter = document.getElementById("categoria").value;
      const words = term.split(/\s+/).filter(w => w && !stopWords.includes(w));

      const container = document.getElementById("destacados");
      container.innerHTML = "";

      // Filtrar productos
      let filtrados = productos.filter(row => {
        const text = normalize(`${row.titulo} ${row.descripcion} ${row.categoria}`);
        const cat = normalize(row.categoria);

        const matchText = words.length === 0 ? true : words.every(w => text.includes(w));
        const matchCat = !catFilter || cat === catFilter;

        return matchText && matchCat && (row.estado || "").toUpperCase() !== "VENDIDA";
      });

      // Mostrar todas las piezas filtradas
      filtrados.forEach(row => {
        const card = crearCard(row);
        if (card) container.appendChild(card);
      });
    }

    fetch("catalogo.csv")
      .then(r => r.text())
      .then(raw => {
        const lines = raw.split(/\r?\n/);
        lines.forEach(line => {
          const obj = parseLine(line);
          if (obj && obj.titulo) productos.push(obj);
        });

       // Mostrar 10 piezas aleatorias al inicio
const container = document.getElementById("destacados");
const disponibles = productos.filter(p => (p.estado || "").toUpperCase() !== "VENDIDA");

// Mezclar aleatoriamente
const mezclados = disponibles.sort(() => Math.random() - 0.5);

// Tomar las primeras 10 despu√©s de mezclar
const visibles = mezclados.slice(0, 5);

visibles.forEach(row => {
  const card = crearCard(row);
  if (card) container.appendChild(card);
});


       // Poblar categor√≠as
const select = document.getElementById("categoria");
const set = new Set(productos.map(p => normalize(p.categoria)).filter(Boolean));
[...set].sort().forEach(cat => {
  const opt = document.createElement("option");
  opt.value = cat;
  opt.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
  select.appendChild(opt);
});

// Activar filtros
document.getElementById("search").addEventListener("input", aplicarFiltros);
document.getElementById("categoria").addEventListener("change", aplicarFiltros);
})
.catch(err => console.error("Error cargando catalogo.csv:", err));

// Modal para ampliar im√°genes
document.addEventListener("click", function(e) {
  if (e.target.tagName === "IMG" && e.target.closest(".product-card")) {
    const modal = document.getElementById("imgModal");
    const imgGrande = document.getElementById("imgGrande");
    modal.style.display = "block";
    imgGrande.src = e.target.src;
  }
});

document.querySelector(".close").onclick = function() {
  document.getElementById("imgModal").style.display = "none";
};

document.getElementById("imgModal").onclick = function(e) {
  if (e.target.id === "imgModal") {
    document.getElementById("imgModal").style.display = "none";
  }
};
</script>

<!-- Contenedor para mostrar publicaciones -->
<div id="productos"></div>

<!-- Bloque para cargar publicaciones desde tu proxy -->
<script>
  async function cargarProductos() {
    try {
      const res = await fetch("https://express-js-on-vercel-one-lilac.vercel.app/api/mercadolibre");
      const data = await res.json();

      const contenedor = document.getElementById("productos");
      contenedor.innerHTML = "";

      if (!data.results || !Array.isArray(data.results)) {
        contenedor.innerHTML = "<p>No se pudieron cargar los productos.</p>";
        console.error("Respuesta inesperada:", data);
        return;
      }

      data.results.forEach(item => {
        const card = `
          <div class="producto">
            <img src="${item.thumbnail}" alt="${item.title}">
            <h3>${item.title}</h3>
            <p>Precio: $${item.price}</p>
          </div>
        `;
        contenedor.innerHTML += card;
      });
    } catch (error) {
      console.error("Error al cargar productos:", error);
      document.getElementById("productos").innerHTML = "<p>Error de conexi√≥n con el servidor.</p>";
    }
  }

  cargarProductos();
</script>

</body>
</html>