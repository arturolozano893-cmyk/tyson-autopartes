<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CatÃ¡logo Tyson Autoparts</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Estilos bÃ¡sicos para el catÃ¡logo de Mercado Libre */
    #ml-catalogo {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin: 40px 20px;
    }
    .ml-producto {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .ml-producto:hover {
      transform: scale(1.05);
    }
    .ml-producto img {
      max-width: 100%;
      border-radius: 6px;
    }
    .ml-producto h3 {
      font-size: 16px;
      margin: 10px 0;
      color: #222;
    }
    .ml-producto p {
      font-size: 14px;
      color: #555;
    }
    .ml-producto a {
      display: inline-block;
      margin-top: 10px;
      padding: 8px 12px;
      background: #0077cc;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      transition: background 0.2s ease;
    }
    .ml-producto a:hover {
      background: #005fa3;
    }
  </style>
</head>
<body>
  <header class="topbar">
    <h1>Tyson Autoparts</h1>
    <nav>
      <ul>
        <li><a href="index.html">Inicio</a></li>
        <li><a href="catalog.html">CatÃ¡logo</a></li>
        <li><a href="contact.html">Contacto</a></li>
      </ul>
    </nav>
    <div class="searchbar">
      <input id="search" type="text" placeholder="Buscar autoparte..." />
      <select id="categoria">
        <option value="">Todas</option>
      </select>
    </div>
  </header>

  <main class="vitrina">
    <!-- Banner -->
    <div class="banner">
      <h2>Tyson Autoparts</h2>
      <p>Encuentra la pieza que necesitas</p>
    </div>

    <!-- Piezas destacadas (CSV) -->
    <section id="destacados" class="grid"></section>

    <!-- CatÃ¡logo Mercado Libre -->
    <section>
      <h2 style="text-align:center; margin-top:20px;">CatÃ¡logo sincronizado con Mercado Libre</h2>
      <div id="ml-catalogo"></div>
    </section>

    <!-- Bloque de confianza -->
    <section class="confianza">
      <!-- ... todo tu bloque de confianza igual que antes ... -->
    </section>

    <!-- Contacto lateral -->
    <aside class="contacto">
      <h3>Contacto directo</h3>
      <a class="wa-btn" href="https://wa.me/5216141315986" target="_blank">ðŸ“² WhatsApp</a>
      <a class="fb-btn" href="https://facebook.com/tysonautoparts" target="_blank">ðŸ”— Facebook</a>
    </aside>
  </main>

  <footer>
    <p>&copy; 2025 Tyson Autoparts | Bryan</p>
  </footer>

  <!-- Modal para imagen ampliada -->
  <div id="imgModal" class="modal">
    <span class="close">&times;</span>
    <img class="modal-content" id="imgGrande">
  </div>

  <script>
    const normalize = s => (s || "")
      .toString()
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();

    const stopWords = ["de","del","la","el","los","las","para","por","un","una"];
    let productos = [];
    let mlProductos = [];

    function parseLine(line) {
      if (!line || !line.trim()) return null;
      const low = line.trim().toLowerCase();
      if (low.startsWith("titulo,descripcion,precio,estado,imagen,categoria")) return null;
      const cols = line.split(",").map(v => v.trim());
      while (cols.length < 6) cols.push("");
      return { titulo: cols[0], descripcion: cols[1], precio: cols[2], estado: cols[3], imagen: cols[4], categoria: cols[5] };
    }

    function crearCard(row) {
      const est = (row.estado || "").trim().toUpperCase();
      if (est === "VENDIDA") return null;
      const card = document.createElement("div");
      card.className = "product-card";
      card.setAttribute("data-categoria", normalize(row.categoria));
      const precioTxt = row.precio ? `$${row.precio}` : "â€”";
      const imgHtml = row.imagen ? `<img src="${row.imagen}" alt="${row.titulo}">` : `<div class="placeholder">Sin imagen</div>`;
      card.innerHTML = `
        ${imgHtml}
        <div class="product-info">
          <h3>${row.titulo}</h3>
          ${row.descripcion ? `<p class="descripcion">${row.descripcion}</p>` : ""}
          <p class="precio">${precioTxt}</p>
          <span class="estado-disponible">âœ… Disponible</span>
          <a class="wa-btn" href="https://wa.me/5216141315986?text=Hola%20quiero%20informaciÃ³n%20sobre%20${encodeURIComponent(row.titulo)}" target="_blank">ðŸ“² Comprar por WhatsApp</a>
        </div>
      `;
      return card;
    }

    function aplicarFiltros() {
      const term = normalize(document.getElementById("search").value);
      const catFilter = document.getElementById("categoria").value;
      const words = term.split(/\s+/).filter(w => w && !stopWords.includes(w));

      const containerCSV = document.getElementById("destacados");
      const containerML = document.getElementById("ml-catalogo");
      containerCSV.innerHTML = "";
      containerML.innerHTML = "";

      // Filtrar CSV
      let filtradosCSV = productos.filter(row => {
        const text = normalize(`${row.titulo} ${row.descripcion} ${row.categoria}`);
        const cat = normalize(row.categoria);
        const matchText = words.length === 0 ? true : words.every(w => text.includes(w));
        const matchCat = !catFilter || cat === catFilter;
        return matchText && matchCat && (row.estado || "").toUpperCase() !== "VENDIDA";
      });

      filtradosCSV.forEach(row => {
        const card = crearCard(row);
        if (card) containerCSV.appendChild(card);
      });

      // Filtrar Mercado Libre
      let filtradosML = mlProductos.filter(row => {
        const text = normalize(`${row.titulo} ${row.descripcion} ${row.categoria}`);
        const cat = normalize(row.categoria);
        const matchText = words.length === 0 ? true : words.every(w => text.includes(w));
        const matchCat = !catFilter || cat === catFilter;
        return matchText && matchCat;
      });

      filtradosML.forEach(row => {
        const card = document.createElement("div");
        card.className = "ml-producto";
        const precioTxt = row.precio ? `$${row.precio}` : "â€”";
        const imgHtml = row.imagen ? `<img src="${row.imagen}" alt="${row.titulo}">` : `<div class="placeholder">Sin imagen</div>`;
        card.innerHTML = `
          ${imgHtml}
          <div class="product-info">
            <h3>${row.titulo}</h3>
            <p class="precio">${precioTxt}</p>
            <span class="estado-disponible">âœ… Disponible</span>
            <a href="https://listado.mercadolibre.com.mx/_CustId_2714166660" target="_blank">ðŸ›’ Ver en Mercado Libre</a>
          </div>
        `;
        containerML.appendChild(card);
      });
    }

    // Cargar CSV
    fetch("catalogo.csv")
      .then(r => r.text())
      .then(raw => {
        const lines = raw.split(/\r?\n/);
        lines.forEach(line => {
          const obj = parseLine(line);
          if (obj && obj.titulo) productos.push(obj);
        });

        aplicarFiltros();

        // Poblar categorÃ­as
        const select = document.getElementById("



